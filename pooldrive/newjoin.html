<!DOCTYPE html>
<html>

<head>
    <script defer src="site.js"></script>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
    <link rel="manifest" href="manifest.json" />
    <meta charset="UTF-8">
    <title>Join Event</title>

    <!--To add image on title bar-->
    <link rel="shortcut icon" href="images/eco.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes">

    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="css/invitation.css">

    <script>
        var g = localStorage.getItem("start");
        var h = localStorage.getItem("dest");
        var i = localStorage.getItem("date");
        var j = localStorage.getItem("vehicle");
        var k = localStorage.getItem("seat");
        console.log(g);
        console.log(h);
        console.log(i);
        console.log(j);
        console.log(k);
        document.getElementById('result').value = JSON.stringify(g);
    </script>

</head>

<body>
    
    <div class="phone" ng-app="delivcard">
        <div class="phone__screen">
            <div class="phone__scroll-cont">
                <div class="phone__content" ng-controller="DelivCtrl">
                    <section ng-repeat="card in cards" class="card theme-{{card.themeColor}}" data-color="{{card.themeColorHex}}">
                        <div class="card__map">
                            <div class="card__map__inner"></div>
                        </div>
                        <section class="card__part card__part-1">
                            <div class="card__part__inner">
                                <header class="card__header">
                                    <div class="card__header__close-btn"></div>
                                    <span class="card__header__id"># {{card.id}}</span>
                                    <span class="card__header__price">&#8377;{{card.price}}</span>
                                </header>
                                <div class="card__stats" ng-style="{'background-image': 'url({{card.bgImgUrl}})'}">
                                    <div class="card__stats__item card__stats__item--req">
                                        <p class="card__stats__type">Vehicle</p>
                                        <span class="card__stats__value">{{card.requests}}</span>
                                    </div>
                                    <div class="card__stats__item card__stats__item--pledge">
                                        <p class="card__stats__type">Date</p>
                                        <span class="card__stats__value">{{card.pledge}}</span>
                                    </div>
                                    <div class="card__stats__item card__stats__item--weight">
                                        <p class="card__stats__type">Seats</p>
                                        <span class="card__stats__value">{{card.weight}}</span>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <section class="card__part card__part-2">
                            <div class="card__part__side m--back">
                                <div class="card__part__inner card__face">
                                    <div class="card__face__colored-side"></div>
                                    <h3 class="card__face__price">&#8377;{{card.price}}</h3>
                                    <div class="card__face__divider"></div>
                                    <div class="card__face__path"></div>
                                    <div class="card__face__from-to">
                                        <p>{{card.fromStreet}}, {{card.fromCity}}</p>
                                        <p>{{card.toStreet}}, {{card.toCity}}</p>
                                    </div>
                                    <div class="card__face__deliv-date">
                                        {{card.delivDateNoun}}
                                        <p>{{card.delivTime}}</p>
                                    </div>
                                    <div class="card__face__stats card__face__stats--req">
                                        Vehicle
                                        <p>{{card.requests}}</p>
                                    </div>
                                    <div class="card__face__stats card__face__stats--pledge">
                                        Date
                                        <p>{{card.pledge}}</p>
                                    </div>
                                    <div class="card__face__stats card__face__stats--weight">
                                        Seats
                                        <p>&nbsp;&nbsp;{{card.weight}}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="card__part__side m--front">
                                <div class="card__sender">
                                    <h4 class="card__sender__heading">Sender</h4>
                                    <div class="card__sender__img-cont">
                                        <div class="card__sender__img-cont__inner">
                                            <img ng-src="{{card.senderImg}}" class="card__sender__img" />
                                        </div>
                                    </div>
                                    <div class="card__sender__name-and-rating">
                                        <p class="card__sender__name">{{card.sender}}</p>
                                        <p class="card__sender__rating card__sender__rating-{{card.rating}}">
                                            <!-- <span class="card__sender__rating__star">&#9733;</span>
                                            <span class="card__sender__rating__star">&#9733;</span>
                                            <span class="card__sender__rating__star">&#9733;</span>
                                            <span class="card__sender__rating__star">&#9733;</span>
                                            <span class="card__sender__rating__star">&#9733;</span>
                                            <span class="card__sender__rating__count">({{card.ratingCount}})</span> -->
                                        </p>
                                        <p class="card__sender__address">
                                            {{card.fromStreet}}, {{card.fromCity}}
                                        </p>
                                    </div>
                                    <div class="card__receiver">
                                        <div class="card__receiver__inner">
                                            <div class="card__sender__img-cont">
                                                <div class="card__sender__img-cont__inner">
                                                    <img ng-src="{{card.senderImg}}" class="card__sender__img" />
                                                </div>
                                            </div>
                                            <div class="card__sender__name-and-rating">
                                                <p class="card__sender__name">{{card.sender}}</p>
                                                <p class="card__sender__address">
                                                    {{card.toStreet}}, {{card.toCity}}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card__path-big"></div>
                                </div>
                                <div class="card__from-to">
                                    <div class="card__from-to__inner">
                                        <div class="card__text card__text--left">
                                            <p class="card__text__heading">From</p>
                                            <p class="card__text__middle">{{card.fromStreet}}</p>
                                            <p class="card__text__bottom">{{card.fromCity}}</p>
                                        </div>
                                        <div class="card__text card__text--right">
                                            <p class="card__text__heading">To</p>
                                            <p class="card__text__middle">{{card.toStreet}}</p>
                                            <p class="card__text__bottom">{{card.toCity}}</p>
                                        </div>
                                    </div>
                                </div>
                                <section class="card__part card__part-3">
                                    <div class="card__part__side m--back"></div>
                                    <div class="card__part__side m--front">
                                        <div class="card__timings">
                                            <div class="card__timings__inner">
                                                <div class="card__text card__text--left">
                                                    <p class="card__text__heading">Departure Time</p>
                                                    <p class="card__text__middle">{{card.delivTime}}</p>
                                                </div>
                                                <div class="card__text card__text--right">
                                                    <p class="card__text__heading">Request Deadline</p>
                                                    <p class="card__text__middle">{{card.reqDl}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card__timer">60 min 00 sec</div>
                                        <section class="card__part card__part-4">
                                            <div class="card__part__side m--back"></div>
                                            <div class="card__part__side m--front">
                                                <button type="button" class="card__request-btn">
                        <span class="card__request-btn__text-1">Request</span>
                        <span class="card__request-btn__text-2">Start</span>
                      </button>
                                                <p class="card__counter">{{card.requests}} people have sent a request</p>
                                            </div>
                                        </section>
                                    </div>
                                </section>
                            </div>
                        </section>
                    </section>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.7.7/angular.min.js"></script>
    <script src='https://maps.googleapis.com/maps/api/js?key=AIzaSyCc7FZQ6jG2VcxnxbMNdkPFFzrUsJxq-ys'></script>

    <script>
        'use strict';

        $(document).ready(function() {

            var animating = false;
            var step1 = 500;
            var step2 = 500;
            var step3 = 500;
            var reqStep1 = 600;
            var reqStep2 = 800;
            var reqClosingStep1 = 500;
            var reqClosingStep2 = 500;
            var $scrollCont = $(".phone__scroll-cont");

            function initMap($card) {
                // my first experience with google maps api, so I have no idea what I'm doing
                var latLngFrom = {
                    lat: 15.3647,
                    lng: 75.1240
                };
                var latLngTo = {
                    lat: 15.8497,
                    lng: 74.4977
                };
                var latLngCenter = {
                    lat: (latLngFrom.lat + latLngTo.lat) / 2,
                    lng: (latLngFrom.lng + latLngTo.lng) / 2
                };
                var themeColor = $card.data("color");

                var map = new google.maps.Map($(".card__map__inner", $card)[0], {
                    zoom: 12,
                    center: latLngCenter,
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    disableDefaultUI: true
                });

                map.set('styles', [{
                    "featureType": "landscape",
                    "elementType": "geometry",
                    "stylers": [{
                        "hue": "#00ffdd"
                    }, {
                        "gamma": 1
                    }, {
                        "lightness": 100
                    }]
                }, {
                    "featureType": "road",
                    "stylers": [{
                        "lightness": 60
                    }, {
                        "hue": "#006eff"
                    }]
                }]);

                var pinImage = new google.maps.MarkerImage(
                    // "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|" + themeColor.slice(1),
                    new google.maps.Size(21, 34),
                    new google.maps.Point(0, 0),
                    new google.maps.Point(10, 34)
                );

                var marker = new google.maps.Marker({
                    position: latLngFrom,
                    map: map,
                    title: 'From',
                    icon: pinImage
                });

                var marker = new google.maps.Marker({
                    position: latLngTo,
                    map: map,
                    title: 'To',
                    icon: pinImage
                });

                var polylineOpts = new google.maps.Polyline({
                    strokeColor: themeColor,
                    strokeWeight: 3
                });
                var rendererOptions = {
                    map: map,
                    polylineOptions: polylineOpts,
                    suppressMarkers: true
                };
                var directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);

                var request = {
                    origin: latLngFrom,
                    destination: latLngTo,
                    travelMode: google.maps.DirectionsTravelMode.DRIVING
                };

                var directionsService = new google.maps.DirectionsService();
                directionsService.route(request, function(response, status) {
                    if (status == google.maps.DirectionsStatus.OK) {
                        directionsDisplay.setDirections(response);
                    } else {
                        console.log("wtf")
                    }
                });
            };

            initMap($(".card"));

            $(document).on("click", ".card:not(.active)", function() {
                if (animating) return;
                animating = true;

                var $card = $(this);
                var cardTop = $card.position().top;
                var scrollTopVal = cardTop - 30;
                $card.addClass("flip-step1 active");

                $scrollCont.animate({
                    scrollTop: scrollTopVal
                }, step1);

                setTimeout(function() {
                    $scrollCont.animate({
                        scrollTop: scrollTopVal
                    }, step2);
                    $card.addClass("flip-step2");

                    setTimeout(function() {
                        $scrollCont.animate({
                            scrollTop: scrollTopVal
                        }, step3);
                        $card.addClass("flip-step3");

                        setTimeout(function() {
                            animating = false;
                        }, step3);

                    }, step2 * 0.5);

                }, step1 * 0.65);
            });

            $(document).on("click", ".card:not(.req-active1) .card__header__close-btn", function() {
                if (animating) return;
                animating = true;

                var $card = $(this).parents(".card");
                $card.removeClass("flip-step3 active");

                setTimeout(function() {
                    $card.removeClass("flip-step2");

                    setTimeout(function() {
                        $card.removeClass("flip-step1");

                        setTimeout(function() {
                            animating = false;
                        }, step1);

                    }, step2 * 0.65);

                }, step3 / 2);
            });

            $(document).on("click", ".card:not(.req-active1) .card__request-btn", function(e) {
                if (animating) return;
                animating = true;

                var $card = $(this).parents(".card");
                var cardTop = $card.position().top;
                var scrollTopVal = cardTop - 30;

                $card.addClass("req-active1 map-active");

                initMap($card);

                setTimeout(function() {
                    $card.addClass("req-active2");
                    $scrollCont.animate({
                        scrollTop: scrollTopVal
                    }, reqStep2);

                    setTimeout(function() {
                        animating = false;
                    }, reqStep2);

                }, reqStep1);
            });

            $(document).on("click",
                ".card.req-active1 .card__header__close-btn, .card.req-active1 .card__request-btn",
                function() {
                    if (animating) return;
                    animating = true;

                    var $card = $(this).parents(".card");

                    $card.addClass("req-closing1");

                    setTimeout(function() {
                        $card.addClass("req-closing2");

                        setTimeout(function() {
                            $card.addClass("no-transition hidden-hack")
                            $card.css("top");
                            $card.removeClass("req-closing2 req-closing1 req-active2 req-active1 map-active flip-step3 flip-step2 flip-step1 active");
                            $card.css("top");
                            $card.removeClass("no-transition hidden-hack");
                            animating = false;
                        }, reqClosingStep2);

                    }, reqClosingStep1);
                });

        });

        // angular used only for templating, I was too tired to find more lightweight solution

        var delivcardDefaultData = [{
            id: '121',
            price: 500,
            requests: j,
            pledge: i,
            weight: k,
            sender: 'Amit Hannikeri',
            senderImg: 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/142996/deliv-sender.jpg',
            themeColor: 'purple',
            themeColorHex: '#BA68C8',
            bgImgUrl: 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/142996/deliv-1.jpg',
            fromStreet: g,
            toStreet: h,
            delivTime: '06:30 pm',
            delivDateNoun: 'Today',
            reqDl: '2 Days'
        }, {
            id: '125',
            price: 700,
            requests: 'Bike',
            pledge: '2019-03-03',
            weight: '1',
            sender: 'Tanvish Minache',
            senderImg: 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/142996/deliv-sender.jpg',
            themeColor: 'green',
            themeColorHex: '#52A43A',
            bgImgUrl: 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/142996/deliv-2.jpg',
            fromStreet: 'Bangalore, Karnataka',
            toStreet: 'Mumbai, Maharastra',
            delivTime: '07:30 am',
            delivDateNoun: 'Today',
            reqDl: '1 Day'
        }, {
            id: '320',
            price: 1500,
            requests: 'Car',
            pledge: '2019-02-25',
            weight: '5',
            sender: 'Rahul Mahendrekar',
            senderImg: 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/142996/deliv-sender.jpg',
            themeColor: 'orange',
            themeColorHex: '#BA68C8',
            bgImgUrl: 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/142996/deliv-1.jpg',
            fromStreet: 'Punjab',
            toStreet: 'Bangalore',
            delivTime: '05:30 am',
            delivDateNoun: 'Today',
            reqDl: '5 Days'
        }, {
            id: '220',
            price: 2000,
            requests: 'Bike',
            pledge: '2019-03-30',
            weight: '1',
            sender: 'Vaibhav Kulkarni',
            senderImg: 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/142996/deliv-sender.jpg',
            themeColor: 'red',
            themeColorHex: '#BA68C8',
            bgImgUrl: 'https://s3-us-west-2.amazonaws.com/s.cdpn.io/142996/deliv-1.jpg',
            fromStreet: 'Belgaum, Karnataka',
            toStreet: 'Ladhak',
            delivTime: '05:00 am',
            delivDateNoun: 'Today',
            reqDl: '3 Days'
        }];

        var app = angular.module("delivcard", []);
        app.controller("DelivCtrl", ['$scope', function($scope) {

            $scope.cards = delivcardDefaultData;

        }]);
    </script>

</body>

</html>